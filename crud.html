<!-- Book Cards Section -->
<section class="book-cards">
    <div class="container">
        <div class="row" id="bookCardsRow">
            <!-- Book cards will be dynamically added here -->
        </div>
    </div>
</section>

<!-- Modal for adding/editing book -->
<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Add/Edit Book</h2>
        <form id="bookForm">
            <input type="hidden" id="bookId">
            <label for="title">Title:</label><br>
            <input type="text" id="title" name="title"><br>
            <label for="author">Author:</label><br>
            <input type="text" id="author" name="author"><br>
            <label for="genre">Genre:</label><br>
            <input type="text" id="genre" name="genre"><br><br>
            <input type="submit" value="Submit">
        </form>
    </div>
</div>

<script>
    // Function to fetch book data from the backend via AJAX
    function fetchBooks() {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'http://localhost/web-project/rest/books', true);
        xhr.onload = function() {
            if (xhr.status >= 200 && xhr.status < 300) {
                var books = JSON.parse(xhr.responseText);
                books.forEach(function(book) {
                    var bookCard = document.createElement('div');
                    bookCard.className = 'col-lg-3 col-md-6';
                    bookCard.innerHTML = `
                        <div class="book-card">
                            <div class="book-image">
                                <img src="https://via.placeholder.com/150" alt="Book Cover Placeholder">
                                <div class="overlay"></div>
                                <div class="book-details">
                                    <h3>${book.title}</h3>
                                    <p>Author: ${book.author}</p>
                                    <p>Genre: ${book.genre}</p>
                                    <button onclick="editBook(${book.book_id})" class="btn-edit">Edit</button>
                                    <button onclick="deleteBook(${book.book_id})" class="btn-delete">Delete</button>
                                </div>
                            </div>
                        </div>
                    `;
                    document.getElementById('bookCardsRow').appendChild(bookCard);
                });
            } else {
                console.error('Request failed:', xhr.status);
            }
        };
        xhr.onerror = function() {
            console.error('Request failed:', xhr.status);
        };
        xhr.send();
    }

    // Function to handle editing a book
    function editBook(bookId) {
        document.getElementById('myModal').style.display = "block";
        // Populate form with book details for editing
        var book = getBookDetails(bookId);
        document.getElementById('bookId').value = book.book_id;
        document.getElementById('title').value = book.title;
        document.getElementById('author').value = book.author;
        document.getElementById('genre').value = book.genre;
    }

    // Function to handle adding/editing a book
    document.getElementById('bookForm').addEventListener('submit', function(e) {
        e.preventDefault();
        var bookId = document.getElementById('bookId').value;
        var title = document.getElementById('title').value;
        var author = document.getElementById('author').value;
        var genre = document.getElementById('genre').value;
        if (bookId) {
            // Edit book
            editBookDetails(bookId, title, author, genre);
        } else {
            // Add new book
            addBook(title, author, genre);
        }
    });

    // Function to handle deleting a book
    function deleteBook(bookId) {
        var confirmDelete = confirm('Are you sure you want to delete this book?');
        if (confirmDelete) {
            var xhr = new XMLHttpRequest();
            xhr.open('DELETE', `http://localhost/web-project/rest/books/${bookId}`, true);
            xhr.onload = function() {
                if (xhr.status >= 200 && xhr.status < 300) {
                    location.reload();
                } else {
                    console.error('Delete request failed:', xhr.status);
                }
            };
            xhr.onerror = function() {
                console.error('Delete request failed:', xhr.status);
            };
            xhr.send();
        }
    }

    // Function to get book details by ID
    function getBookDetails(bookId) {
        // Make AJAX request to fetch book details by ID
        // Return book details from backend
    }

    // Function to add a new book
    function addBook(title, author, genre) {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', 'http://localhost/web-project/rest/books/add', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onload = function() {
            if (xhr.status >= 200 && xhr.status < 300) {
                location.reload();
            } else {
                console.error('Add book request failed:', xhr.status);
            }
        };
        xhr.onerror = function() {
            console.error('Add book request failed:', xhr.status);
        };
        var data = JSON.stringify({ title: title, author: author, genre: genre });
        xhr.send(data);
    }

    // Function to edit book details
    function editBookDetails(bookId, title, author, genre) {
        var xhr = new XMLHttpRequest();
        xhr.open('PUT', `http://localhost/web-project/rest/books/${bookId}`, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onload = function() {
            if (xhr.status >= 200 && xhr.status < 300) {
                location.reload();
            } else {
                console.error('Edit book request failed:', xhr.status);
            }
        };
        xhr.onerror = function() {
            console.error('Edit book request failed:', xhr.status);
        };
        var data = JSON.stringify({ title: title, author: author, genre: genre });
        xhr.send(data);
    }

    // Close modal when close button is clicked
    document.getElementsByClassName('close')[0].onclick = function() {
        document.getElementById('myModal').style.display = "none";
    }

    window.onload = fetchBooks;
</script>
